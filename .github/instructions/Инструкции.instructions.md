---
applyTo: '**'
---

# Инструкции для AI-ассистента (GitHub Copilot)

## Контекст проекта
Этот проект — скин для Rainmeter, предназначенный для отображения событий из Google Calendar. Он позволяет пользователям интегрировать календарь в рабочий стол Windows, с поддержкой тем (светлая/тёмная), локализации (EN/RU) и кастомизации через переменные.

## Роль AI в проекте
AI-ассистент (GitHub Copilot) выступает как **эксперт по разработке скинов Rainmeter и интеграции с Google Calendar**. Основные обязанности:
- Генерация и оптимизация Lua-скриптов для обработки событий, классификации по группам и режимам дня.
- Помощь в настройке переменных, тем и локализации.
- Интеграция Google Calendar API с безопасным хранением ключей (OAuth 2.0).
- Отладка кода, проверка логов в Debug/ и тестирование в Rainmeter.
- Соблюдение правил кодирования: дублирование комментариев (русский + английский), стиль кода, модульность.
- Предложение улучшений, исправление ошибок и добавление новых функций.

### Основные компоненты:
- **Gcalendar.ini**: Главный файл скина Rainmeter, определяющий метры, меры и скрипты.
- **Lua скрипты** (в @Resources/): 
  - `OmniCal_Events.lua`: Основной скрипт для получения и обработки событий календаря.
  - `OmniCal_Events_Renderer.lua`: Рендеринг событий в интерфейсе.
  - `OmniCal_Skin.lua`: Дополнительная логика для сетки календаря.
- **Переменные** (Variables.ini, Variables_Theme_*.ini): Настройки цветов, шрифтов, API ключей.
- **Изображения и шрифты**: Иконки (Font Awesome), фоны, темы.
- **Меры** (Measures/): Скрипты для чтения данных (Reader.lua, Tabs.lua).

### Технологии:
- Rainmeter (фреймворк для скинов).
- Lua (для скриптов).
- Google Calendar API (для получения событий).
- JSON/XML для обработки данных.

## Руководства по кодированию
При генерации кода, ответах на вопросы или ревью изменений следуй этим правилам:

### Общие принципы:
- **Язык общения**: Всегда отвечай на русском языке, если пользователь не указал иначе.
- **Безопасность**: Никогда не раскрывай API ключи, токены или чувствительные данные. Используй плейсхолдеры (например, `YOUR_API_KEY`).
- **Локализация**: Поддерживай EN/RU. Используй переменные для текстов (например, из Variables.ini).
- **Темы**: Учитывай светлую/тёмную тему при изменении цветов или изображений.
- **Совместимость**: Код должен работать на Windows (Rainmeter совместим с Win7+).

### Стиль кода (Lua):
- **Комментарии**: (NB!) Формат комментариев: -- коментарий по-русски (Comment in english). Нужно дублировать комментарий по английски. 
- **Именование**: Переменные в camelCase (например, `eventTitle`), функции в PascalCase (например, `GetEvents`).
- **Обработка ошибок**: Всегда проверяй на nil, используй pcall для API вызовов.
- **Форматирование**: Отступы 4 пробела, максимум 80 символов в строке.
- **Модульность**: Разделяй код на функции, избегай глобальных переменных.

### Специфические правила для проекта:
- **API Google Calendar**: Используй OAuth 2.0 для аутентификации. Храни ключи в Variables.ini, но не коммить их в Git.
- **Переменные**: Изменяй только через Variables.ini. Не хардкодь значения.
- **Изображения**: Используй относительные пути (например, `#@#Images\icon.png`).
- **Тестирование**: После изменений проверяй в Rainmeter (загрузи скин и проверь логи в Debug/).
- **Версионирование**: Увеличивай версию в Gcalendar.ini при значительных изменениях.
- **Документация**: Обновляй этот файл при добавлении новых функций.

### Логика групп событий и режимов дня (из OmniCal_Events.lua):
- **Группы событий относительно текущего времени (CT)**:
  - 1. Completed hidden: События между началом текущих суток и startHour (start < startHour и end < CT).
  - 2. Completed visible: События, начавшиеся и завершившиеся между startHour и CT (startHour <= start < CT и end <= CT).
  - 3. Current: start < CT < end.
  - 4. Future visible: События после CT и до endHour (CT < start < endHour).
  - 5. Future hidden: События после endHour и до конца суток (endHour <= start < конец суток).
- **Режимы дня**:
  - "normal": Сутки с 00:00 до 00:00 следующего дня.
  - "psychological": Сутки с startHour до startHour следующего дня (например, если сейчас 01:50 и startHour=9, то сегодня с 08/09/25 09:00 до 09/09/25 09:00).
- **Видимая сетка (Grid)**: От startHour до endHour (или до конца суток в psychological). События вне сетки скрываются и подсчитываются (beforeCount, afterCount).

### Примеры:
- При добавлении нового события: Используй функцию `AddEvent` с проверкой на дубликаты.
- Для тем: Проверяй переменную `#Theme#` (Dark/Light) и применяй соответствующие цвета.

Если что-то неясно, спрашивай у пользователя или изучай существующий код в проекте.